-- Table to store Movie information
CREATE TABLE MOVIES
(
    ID                  NUMBER
        GENERATED AS IDENTITY PRIMARY KEY,
    TMDB_MOVIE_ID       NUMBER
        CONSTRAINT NN_MOVIES_TMDB_MOVIE_ID NOT NULL
        CONSTRAINT UN_MOVIES_TMDB_MOVIE_ID UNIQUE,
    TITLE               VARCHAR2(255)
        CONSTRAINT NN_MOVIES_TITLE NOT NULL,
    VOTE_AVERAGE        NUMBER(4, 1)
        CONSTRAINT CH_VOTE_AVERAGE CHECK (VOTE_AVERAGE BETWEEN 0 AND 10),
    RELEASE_DATE        DATE,
    DURATION_IN_SECONDS NUMBER
        CONSTRAINT CH_DURATION_IN_SECONDS CHECK (DURATION_IN_SECONDS >= 0),
    ORIGINAL_TITLE      VARCHAR2(255),
    ORIGINAL_LANGUAGE   VARCHAR2(30),
    IMAGE_PATH          VARCHAR2(255),
    BUDGET              NUMBER(20, 2)
);

CREATE TABLE LANGUAGES
(
    ID   NUMBER GENERATED AS IDENTITY PRIMARY KEY,
    NAME VARCHAR2(100)
        CONSTRAINT NN_LANGUAGES_NAME NOT NULL, -- No unique constraint, "English" can be British and American
    CODE VARCHAR2(3)
        CONSTRAINT NN_LANGUAGES_CODE NOT NULL
        CONSTRAINT UN_LANGUAGES_CODE UNIQUE
);

-- Table to store Person information
CREATE TABLE PERSONS
(
    ID             NUMBER GENERATED AS IDENTITY PRIMARY KEY,
    TMDB_PERSON_ID NUMBER
        CONSTRAINT NN_PERSONS_TMDB_PERSON_ID NOT NULL
        CONSTRAINT UN_PERSONS_TMDB_PERSON_ID UNIQUE,
    NAME           VARCHAR2(255)
);

-- Table to store Department information
CREATE TABLE DEPARTMENTS
(
    ID   NUMBER GENERATED AS IDENTITY PRIMARY KEY,
    NAME VARCHAR2(100)
        CONSTRAINT NN_DEPARTMENTS_NAME NOT NULL
        CONSTRAINT UN_DEPARTMENTS_NAME UNIQUE
);

-- Table to store Job information, which references Department
CREATE TABLE JOBS
(
    ID            NUMBER GENERATED AS IDENTITY PRIMARY KEY,
    NAME          VARCHAR2(100)
        CONSTRAINT NN_JOBS_NAME NOT NULL
        CONSTRAINT UN_JOBS_NAME UNIQUE,
    DEPARTMENT_ID NUMBER,
    CONSTRAINT FK_JOBS_DEPARTMENTS FOREIGN KEY (DEPARTMENT_ID) REFERENCES DEPARTMENTS (ID)
);

-- Table to store Credit information, which references Person, Job, and Movie
CREATE TABLE CREDITS
(
    ID           NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    TMDB_CAST_ID NUMBER
        CONSTRAINT NN_CREDIT_TMDB_CAST_ID NOT NULL
        CONSTRAINT UN_CREDIT_TMDB_CAST_ID UNIQUE,
    PERSON_ID    NUMBER,
    JOB_ID       NUMBER,
    CHARACTER    VARCHAR2(255),
    MOVIE_ID     NUMBER,
    CONSTRAINT FK_PERSONS FOREIGN KEY (PERSON_ID) REFERENCES PERSONS (ID),
    CONSTRAINT FK_JOBS FOREIGN KEY (JOB_ID) REFERENCES JOBS (ID),
    CONSTRAINT FK_MOVIES FOREIGN KEY (MOVIE_ID) REFERENCES MOVIES (ID)
);

-- Table to store Genre information
CREATE TABLE GENRES
(
    ID            NUMBER GENERATED AS IDENTITY PRIMARY KEY,
    TMDB_GENRE_ID NUMBER
        CONSTRAINT NN_GENRES_TMDB_GENRE_ID NOT NULL
        CONSTRAINT UN_GENRES_TMDB_GENRE_ID UNIQUE,
    GENRE_NAME    VARCHAR2(100)
        CONSTRAINT NN_GENRES_GENRE_NAME NOT NULL
        CONSTRAINT UN_GENRES_GENRE_NAME UNIQUE
);

-- Associative table between movies and genres
CREATE TABLE MOVIES_GENRES
(
    MOVIE_ID NUMBER,
    GENRE_ID NUMBER,
    CONSTRAINT FK_MOVIES_GENRES_MOVIES FOREIGN KEY (MOVIE_ID) REFERENCES MOVIES (ID),
    CONSTRAINT FK_MOVIES_GENRES_GENRES FOREIGN KEY (GENRE_ID) REFERENCES GENRES (ID),
    PRIMARY KEY (MOVIE_ID, GENRE_ID)
);